





### Netflix Ribbon默认自带的负载规则

AbstractLoadBalancer 中的 BaseLoadBalancer 实现类中定义了默认的负载规则为线性负载均衡规则。

![image-20210904220051094](https://cdn.jsdelivr.net/gh/YangZhiqiang98/ImageBed/image-20210904220051094.png)



自定义的话需要实现接口**IRule**。

![image-20210905093158791](https://cdn.jsdelivr.net/gh/YangZhiqiang98/ImageBed/image-20210905093158791.png)

1、RoundRobinRule :轮询  --- 默认
2、RandomRule:随机
3、RetryRule:先按照RoundRobinRule的策略获取服务，如果获取服务失败则在指定时间内会重试，获取可用的服务
4、WeightedResponseTimeRule：对RoundRobinRule的扩展，响应速度越快的实力选择的权重越大，越容易被选择
5、BestAvailableRule：会先过滤掉由于多次访问故障而处于断路跳闸状态的服务，然后选择一个并发量最小的服务
6、AvailabilityFilteringRule：会先过滤掉故障实例和负载高的实例，然后再轮询选择
7、ZoneAvoidanceRule：默认规则，复合判断server所在的区域的性能和server的可用性选择服务器

### 负载规则替换
官方文档给出警告，这个自定义配置类不能放在@Componement所扫描的包和子包下，否则这个自定义配置类就会被所有的Ribbon客户端所共享，达不到特殊定制的目的。即不能与@SpringBootApplication项目包下。
![Image3](https://cdn.jsdelivr.net/gh/YangZhiqiang98/ImageBed/Image3.png)
![Image5](https://cdn.jsdelivr.net/gh/YangZhiqiang98/ImageBed/Image5.png)

### 手写轮询负载规则
![Image6](https://cdn.jsdelivr.net/gh/YangZhiqiang98/ImageBed/Image6.png)

![Image7](https://cdn.jsdelivr.net/gh/YangZhiqiang98/ImageBed/Image7.png)

![Image8](https://cdn.jsdelivr.net/gh/YangZhiqiang98/ImageBed/Image8.png)