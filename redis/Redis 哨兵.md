判断主服务器是否下线有两种情况：

- 主观下线

	 - Sentinel 会以每秒一次的频率向与它创建命令连接的实例(包括主从服务器和其他的 Sentinel)**发送 PING 命令**，通过 PING 命令返回的信息判断实例是否在线
  - 如果一个**主服务器**在 down-after-milliseconds 毫秒内连续向 Sentinel 发送**无效回复**，那么当前 Sentinel 就会**主观认为**该主服务器已经下线了。

- 客观下线

	- 当 Sentinel 将一个主服务器判断为主观下线以后，为了确认该主服务器是否真的下线，它会向同样监视该主服务器的 Sentinel **询问**，看它们是否也认为该主服务器是否下线。
  - 如果**足够多**的 Sentinel 认为该主服务器是下线的，那么就判定该主服务为客观下线，并对主服务器执行故障转移操作。

> 目前为止的主从+哨兵架构可以说 Redis 是高可用的，但要清楚的是：Redis 还是会**丢失数据**的

丢失数据有两种情况：

- 异步复制导致的数据丢失

	- **有部分数据还没复制到从服务器，主服务器就宕机了**，此时这些部分数据就丢失了

- 脑裂导致的数据丢失

	 - 有时候主服务器脱离了正常网络，跟其他从服务器不能连接。此时哨兵可能就会**认为主服务器下线了**(然后开启选举，将某个从服务器切换成了主服务器)，但是实际上主服务器还运行着。这个时候，集群里就会有两个主服务器(也就是所谓的脑裂)。
  - 虽然某个从服务器被切换成了主服务器，但是可能客户端**还没来得及切换到新的主服务器**，客户端还继续写向旧主服务器写数据。旧的服务器重新连接时，会作为从服务器复制新的主服务器(这意味着旧数据丢失)。